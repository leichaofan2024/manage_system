<div class="contentpanel">
  <div class="wage-navbar">
    <%= link_to "返回",high_speed_rail_stuffs_path,class:"nav-item" %>
    <ul class="nav nav-pills">
      <li class="nav-item" id="">
        <a href="#">人员公式</a>
      </li>
      <li class="nav-item" id="">
        <a href="#">金额公式</a>
      </li>
    </ul>
  </div>
  <div class="panel">
    <div class="panel-heading">
      <h4>新增表头(人员公式)</h4>
    </div>

    <div class="panel-body">
      <%= form_tag create_head_high_speed_rail_stuffs_path,method: :post do %>
          <%= label_tag "表头名称：" %>
          <%= hidden_field_tag "high_head_name",@high_speed_stuff %>
          <%= text_field_tag "head_name"  %>
          <div class="">
            当前筛选条件：
          </div>
               <div class="form-group">
                 <label for="type">请选择项目</label>
                   <select style="width: 50%" id="selid" onchange="selCity(this)">
                     <% @employee_columns.each do |key| %>
                       <option value="<%= key%>"><%= Employee.head_transfer[key] %></option>
                     <% end %>
                   </select>
               </div>
               <div class="form-group">
                 <label>请填入筛选条件</label>
                   <span id="subselid"></span>
               </div>
          <%= submit_tag :提交,:data => {:disable_with => "正在提交..."} %>
          <% end %>
      <div class="subpanel-body">

      </div>

    </div>

  </div>
</div>



  <!-- <%= form_tag create_head_high_speed_rail_stuffs_path,method: :post do %>
<%= label_tag "表头名称：" %>
<%= hidden_field_tag "high_head_name",@high_speed_stuff %>
<%= text_field_tag "head_name"  %>
<br>
<%= label_tag "资金计算公式："%>
<br>
<br>
<% (Wage.head_transfer.keys - ["col1","col2","col3","col4","col5","col6","col7","col8","col9","col10","col11","col12"]).each do |key| %>
<span style = "margin-left:20px;display:inline-block;width:200px">
&nbsp;&nbsp;
<span >
<select class="" name= "<%= key%>">
<option disabled selected value>--请选择--</option>
<option value="1">+</option>
<option value="2">-</option>

</select>
</span>
<%= label_tag Wage.head_transfer[key]%>
</span>
<% end %>
<span style = "margin:20px;display:inline-block;width:100%;">
&nbsp;&nbsp;<%= label_tag "除以人数：" %>
<select class="" name= "per_capita">
<option disabled selected value>--请选择--</option>
<% HighSpeedRailStuffHead.pluck(:head_name).each do |head_name| %>
<option value="<%= head_name %>"><%= head_name %></option>
<% end %>
</select>
</span>
<br>
<br>
<%= label_tag "人数计算公式："%>
<br>
<br>

<span style = "margin-left:20px;display:inline-block;width:200px">
&nbsp;&nbsp;<%= label_tag "期末人数" %>
<%= check_box_tag "final_period","yes" %>
</span>
<span style = "margin-left:20px;display:inline-block;width:200px">
&nbsp;&nbsp;<%= label_tag "平均人数" %>
<%= check_box_tag "average","yes" %>
</span>
<br>
<br>
<% (Employee.attribute_names - ["id","created_at","updated_at","avatar","group_id","workshop_id","name"]).each do |key| %>
<span style = "margin-left:20px;display:inline-block;width:200px">
&nbsp;&nbsp;<%= label_tag Employee.head_transfer[key] %>
<span >
<% if key == "workshop" %>
<select multiple="multiple" class="form-control" name="<%= key + "[]"%>" id="<%= key%>">
<% Workshop.current.each do |workshop| %>
<option value="<%= workshop.id %>"><%= workshop.name %></option>
<% end %>
</select>
<% elsif key == "group"%>
<select multiple="multiple" class="form-control" name="<%= key + "[]"%>" id="<%= key%>">
<% Group.current.each do |group| %>
<option value="<%= group.id %>"><%= group.name %></option>
<% end %>
</select>
<% else %>
<%=  select_tag key,options_for_select(Employee.pluck(key).uniq),multiple: true,class: "form-control" %>
<% end %>
<script>

</script>
</span>

</span>

<% end %>
<br>
<br>
<%= submit_tag :提交,:data => {:disable_with => "正在提交..."} %>
<% end %> -->



<script type="text/javascript">

    function selCity()
    {
        var arr = gon.employee_array;
        var textarr = gon.employee_key;

        var selNode = document.getElementById("selid");
        var subselNode = document.getElementById("subselid");

        var index = selNode.selectedIndex;
        var citys = arr[index];


        var keys = textarr[index];

        var selectNode = document.createElement("select");
        subselNode.appendChild(selectNode);
        selectNode.name = citys[0]+"[]";
        selectNode.id = citys[0];

        var selectBlock = document.getElementById(citys[0]);

        for(var i=0; i<citys[1].length; i++)
        {
            var optionNode = document.createElement("option");
            optionNode.value = citys[1][i];
            optionNode.innerText = citys[1][i];
            selectBlock.appendChild(optionNode);
        };

        selectBlock.multiple = true;
        selectBlock.setAttribute("style", "width: 50%");
      $("#"+citys[0]).before(document.createTextNode(keys));
      $("#"+citys[0]).select2( {
        theme: "bootstrap"
      } );
    };

  $("#selid").select2();

</script>
