<div class="contentpanel">
  <div class="wage-navbar">
    <%= link_to "返回",high_speed_rail_stuffs_path,class:"nav-item" %>
    <ul class="nav nav-pills">
      <li class="nav-item">
        <a href="/high_speed_rail_stuffs/new_head">人员公式</a>
      </li>
      <li class="nav-item">
        <a href="/high_speed_rail_stuffs/new_head_wage">金额公式</a>
      </li>
    </ul>
  </div>
  <div class="panel">
    <div class="panel-heading">
      <h4>新增表头(人员公式)</h4>
    </div>

    <div class="panel-body">
      <%= form_tag create_head_high_speed_rail_stuffs_path,method: :post do %>

      <div class="form-group">
        <%= label_tag "表头名称：" %>
        <%= hidden_field_tag "high_head_name",@high_speed_stuff %>
        <%= text_field_tag "head_name"  %>
      </div>
      <div class="form-group">
        <span>
        <%= label_tag "除以人数：" %>
        <select class="" name= "per_capita">
        <option disabled selected value>--请选择--</option>
        <% HighSpeedRailStuffHead.pluck(:head_name).each do |head_name| %>
        <option value="<%= head_name %>"><%= head_name %></option>
        <% end %>
        </select>
        </span>
      </div>
      <div class="form-group">
        <%= label_tag "人数计算公式："%>
        <span>
        <%= label_tag "期末人数" %>
        <%= check_box_tag "final_period","yes" %>
        </span>
        <span>
        <%= label_tag "平均人数" %>
        <%= check_box_tag "average","yes" %>
        </span>
      </div>

      <div class="form-group">
        <label>选择项目</label>
        <select id="wage" onchange="selWage(this)">
          <% (Wage.head_transfer.keys - ["col1","col2","col3","col4","col5","col6","col7","col8","col9","col10","col11","col12"]).each do |key| %>
          <option><%= Wage.head_transfer[key] %></option>
          <% end %>
        </select>
      </div>
      <label>资金计算公式:</label>
      <div class="form-group" style="height: 500px;padding: 20px; background-color: #FFFF;">
        <span id="subwage" class="subwage"></span>
      </div>
      <%= submit_tag :提交,:data => {:disable_with => "正在提交..."}, class: "btn btn-success-alt pull-right" %>
      <% end %>


      <div class="subpanel-body">
        <strong>使用指南:</strong>
        <ul>
          <li>先选择项目，再选择或输入筛选条件，点击方框里的加号会再显示一组筛选框</li>
          <li>点击【当前计算公式】后项目里的 X 可以直接删除这个筛选条件</li>
        </ul>
      </div>
    </div>

  </div>
</div>


<script type="text/javascript">
  $("#wage").select2({
    width: "resolve"
  });
  function selWage()
  {
    var arr = gon.wage_arry;
    var wage = document.getElementById("wage");
    var index = wage.selectedIndex;
    var keys = arr[index];
    var wageArry = gon.wages;
    var subWage = document.getElementById("subwage");

    var subChild = document.createElement("select");
        subWage.appendChild(subChild);
        subChild.name = wageArry[index];
        subChild.id = wageArry[index];

    var subseleNode = document.getElementById(wageArry[index]);
    var plusArry = [["1","加"],["2","减"]];

        for(var i=0; i< plusArry.length; i++)
        {
          var subOption = document.createElement("option");
              subOption.value = plusArry[i][0];
              subOption.innerText = plusArry[i][1];

          subseleNode.appendChild(subOption);
        };

        var wageCreate = document.createElement("div");
        var wageKey = document.createTextNode(keys);
            wageCreate.appendChild(wageKey);
        $("#"+wageArry[index]).before(wageCreate);

        wageCreate.setAttribute("style", "margin: 10px 0;")

        $("#"+wageArry[index]).select2({
          width: "element"
        });
  }
</script>
