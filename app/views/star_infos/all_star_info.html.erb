<div class="panel-heading">
  <div class="wage-navbar">
    <ul class="nav nav-pills">
      <li class="nav-item">
        <a class="nav-link active" href="/star_infos/five_star_info">五星岗位</a>
      </li>
      <li class="nav-item">
        <a class="nav-link" href="#">全部岗位</a>
      </li>
    </ul>
  </div>
</div>
<button  onclick="toggle_visibility('employee-btn');" type="button" name="button" class="btn btn-success-alt">
	<span class="glyphicon glyphicon-filter"></span>搜索/筛选
</button>
<%= form_tag all_star_info_star_infos_path, method: :get do%>
	<%= label_tag :"请选择年份和季度：" %>
	<%= select_tag(:year, options_for_select(BasicScore.pluck(:year).uniq), {:required => "true"}) %>
	<%= select_tag(:quarter, options_for_select(BasicScore.pluck(:quarter).uniq), {:required => "true"}) %>
	<%= submit_tag :筛选 %>
<% end %>
<% if @type == "passed" %>
	<%= link_to "查看全部五星",all_star_info_star_infos_path(type: "all"), class:"btn btn-success-alt pull-right" %>
<% else %>
	<%= link_to "查看通过五星",all_star_info_star_infos_path(type: "passed"), class:"btn btn-success-alt pull-right" %>
<% end %>
<% if (current_user.has_role? :workshopadmin) %>
	<%= link_to "发起申请",new_star_application_path, class:"btn btn-success-alt pull-right" %>
	<%= link_to "查看申请",star_applications_path(type: 0), class:"btn btn-success-alt pull-right" %>
<% elsif (current_user.has_role? :staradmin) || (current_user.has_role? :superadmin) %>
	<%= link_to "查看申请(#{StarApplication.where(status: 0).count})",star_applications_path(type: 0), class:"btn btn-success-alt pull-right" %>
<% end %>
<%= link_to "导出表格",all_star_info_star_infos_path(format: "xls", type: @type), class:"btn btn-success-alt pull-right" %>
<h4 class="text-center">全部星级岗位表</h4>
<table class="table overflow-y table-bordered table-striped">
	<thead>
		<tr>
			<th>序号</th>
			<th>姓名</th>
			<th>工资号</th>
			<th>车间</th>
			<th>班组</th>
			<th>职名</th>
			<th>分数</th>
			<th>星级</th>
			<% if (current_user.has_role? :staradmin) || (current_user.has_role? :superadmin) %>
				<th>操作</th>
			<% end %>
		</tr>
	</thead>
	<tbody>
		<% i = 1 %>
		<% @scores.each do |score| %>
			<tr>
				<td><%= i %></td>
				<% i += 1 %>
				<td><%= score.name %></td>
				<td><%= score.sal_number %></td>
				<td><%= score.workshop %></td>
				<td><%= score.group %></td>
				<td><%= score.duty %></td>
				<td><%= score.final_score %></td>
				<td><%= StarInfo.find_by(basic_score_id: score.id).star %>星</td>
				<% if (current_user.has_role? :staradmin) || (current_user.has_role? :superadmin) %>
					<td><%= link_to "升/降星", show_star_modal_star_infos_path(star_info: StarInfo.find_by(basic_score_id: score.id).id), remote: true, "data-toggle" => "modal", "data-target" => "#starModal", class: "btn btn-primary" %></td>
				<% end %>
			</tr>
		<% end %>
	</tbody>
</table>

<div id="showStarModal">
	<%= render 'show_star_modal' %>
</div>

<div class="panel-body" id="employee-btn">
	<ul class="employee-search">
	  <div class="row">
	    <div class="col-md-6 mb15">
	      <li style="padding-top: 20px;">
	        <%= form_tag search_star_infos_path, :class => "posts-search-form", :method => :get do %>
	          <div class="input-group">
	            <input type="text" class="form-control search-bar-input" name="q" value="<%= params[:q] %>" placeholder="输入姓名或工资号">
	            <span class="input-group-btn">
	              <button type="submit" class="btn btn-primary">
	                <span class="glyphicon glyphicon-search"></span>
	              </button>
	            </span>
	          </div>
	        <% end %>
	      </li>
	    </div>
	  </div>


	  <li>
	    <%= form_tag filter_employees_path, method: 'get' do %>
	      <% if (current_user.has_role? :leaderadmin) || (current_user.has_role? :depudy_leaderadmin) ||(current_user.has_role? :superadmin) || (current_user.has_role? :empadmin) || (current_user.has_role? :attendance_admin) || (current_user.has_role? :limitadmin) || (current_user.has_role? :awardadmin) || (current_user.has_role? :saleradmin) || (current_user.has_role? :incomeadmin) || (current_user.has_role? :staradmin) %>
	        <li style="display: inline-block;margin-bottom: 5px;">车间：
	            <select name="workshop"  id="selid" onchange="selCity(this)">
	              <option value="" selected >北京供电段</option>
	              <% Workshop.current.each do |workshop| %>
	                <% if workshop.id == params[:workshop].to_i %>
	                  <option value="<%= workshop.id%>" selected><%= workshop.name%></option>
	                <% else %>
	                  <option value="<%= workshop.id%>"><%= workshop.name%></option>
	                <% end %>
	              <% end %>
	            </select>
	        </li>
	        <li>班组：
	          <span class="employee-group-input" style="display:inline-block;">
	            <select name="group[]"  id="subselid" multiple="multiple" class="form-control group-batch-select" style="width:400px;height:20px;">
	            </select>
	          </span>
	        </li>
	      <% elsif current_user.has_role? :workshopadmin %>
	        <li>班组：
	          <span class="employee-group-input" style="display:inline-block;">
	            <select name="group[]" multiple="multiple"  class="form-control group-batch-select" style="width:400px;height:20px;">
	              <% Group.current.where(:workshop_id => current_user.workshop_id).each do |group| %>
	                <option value="<%= group.id%>"><%= group.name%></option>
	              <% end %>
	            </select>
	          </span>
	        </li>
	      <% end %>


	      <% if !current_user.has_role? :safe_productionadmin %>
	      <br>
	        <%= label_tag :按男女： %>
	        <select class="" name="sex">
	          <option value>请选择</option>
	          <% ["男","女"].each do |sex| %>
	            <% if params[:sex] == sex %>
	              <option value="<%= sex %>" selected><%= sex %></option>
	            <% else %>
	              <option value="<%= sex %>"><%= sex %></option>
	            <% end %>
	          <% end %>
	        </select>
	        <%= label_tag :按职务： %>
	        <select class="" name="duty">
	          <option value>请选择</option>
	          <% Employee.pluck("duty").uniq.compact.each do |duty| %>
	            <% if params[:duty] == duty %>
	              <option value="<%= duty %>" selected><%= duty %></option>
	            <% else %>
	              <option value="<%= duty %>"><%= duty %></option>
	            <% end %>
	          <% end %>
	        </select>
	      <% end %>
	      <%= label_tag :按技术职称： %>
	      <select class="" name="work_type">
	        <option value>请选择</option>
	        <% Employee.pluck("work_type").uniq.compact.each do |work_type| %>
	          <% if params[:work_type] == work_type %>
	            <option value="<%= work_type %>" selected><%= work_type %></option>
	          <% else %>
	            <option value="<%= work_type %>"><%= work_type %></option>
	          <% end %>
	        <% end %>
	      </select>
	      <div class="row">
	        <div class="col-md-12">
	          <% if !current_user.has_role? :safe_productionadmin %>
	            <%= label_tag :按时间段选择： %>
	            <select class="" name="filter_type">
	              <option value>请选择</option>
	              <% ["年龄","工龄","路龄"].each do |filter_type| %>
	                <% if params[:filter_type] == filter_type %>
	                  <option value="<%= filter_type %>" selected><%= filter_type %></option>
	                <% else %>
	                  <option value="<%= filter_type %>"><%= filter_type %></option>
	                <% end %>
	              <% end %>
	            </select>

	            <%= text_field_tag :start_time %> ~
	            <%= text_field_tag :end_time %>
	          <% end %>
	        </div>
	      </div>
	      <%= submit_tag :筛选,:data => {disable_with: "筛选中..."} %>
	    <% end %>
	  </li>
	</ul>
</div>
<script type="text/javascript">
	function toggle_visibility(id) {
		var e = document.getElementById(id);
		if(e.style.display == 'block')
			e.style.display = 'none';
		else
			e.style.display = 'block';
  	};
</script>

